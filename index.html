<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>My Simplifi (Lite)</title>
<style>
  :root{
    --bg:#0e1117; --card:#141923; --muted:#9aa3b2; --text:#eef1f7;
    --line:#222838; --acc:#6ee7b7; --acc2:#60a5fa; --bad:#f87171; --good:#34d399;
  }
  *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  body{margin:0;background:linear-gradient(180deg,#0e1117,#0b0f1a);color:var(--text)}
  header{position:sticky;top:0;z-index:10;background:#0f1422cc;backdrop-filter:blur(6px);
    display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 16px;border-bottom:1px solid var(--line)}
  h1{margin:0;font-size:16px;letter-spacing:.2px}
  nav{display:flex;gap:6px;flex-wrap:wrap}
  nav button{border:1px solid var(--line);background:#12172a;color:var(--text);padding:8px 12px;border-radius:10px;font-weight:600}
  nav button.active{background:var(--acc2);color:#071222;border-color:transparent}
  main{padding:18px;max-width:980px;margin:0 auto}
  .card{background:linear-gradient(180deg,#12182a,#0f1422);border:1px solid var(--line);border-radius:16px;padding:14px;margin-bottom:14px}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .row>.card{flex:1 1 300px}
  label{display:block;color:var(--muted);font-size:12px;margin-bottom:6px}
  input,select,textarea{width:100%;padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#0f1528;color:var(--text)}
  input[type="month"],input[type="date"]{padding:8px 10px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px 8px;border-bottom:1px dashed #1e2536;font-size:14px}
  th{color:#cfd7ff;background:#10162b;position:sticky;top:52px}
  tfoot td{border-top:1px solid var(--line);font-weight:700}
  .right{text-align:right}.mono{font-feature-settings:"tnum" 1,"lnum" 1;font-variant-numeric:tabular-nums lining-nums}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px}
  .p-green{background:rgba(110,231,183,.12);color:#6ee7b7}
  .p-blue{background:rgba(96,165,250,.12);color:#60a5fa}
  .p-red{background:rgba(248,113,113,.12);color:#f87171}
  .btn{cursor:pointer;background:var(--acc2);color:#071222;border:none;border-radius:10px;padding:10px 12px;font-weight:700}
  .btn.secondary{background:transparent;color:var(--text);border:1px solid var(--line)}
  .muted{color:var(--muted);font-size:12px}
  .group{background:#10162b;font-weight:800}
  .good{color:var(--good)} .bad{color:var(--bad)}
</style>
</head>
<body>
<header>
  <h1>My Simplifi • clean & minimal</h1>
  <nav id="nav"></nav>
</header>
<main id="view"></main>

<script>
/* ========= Utilities ========= */
const $=(s,e=document)=>e.querySelector(s);const $$=(s,e=document)=>Array.from(e.querySelectorAll(s));
const money=n=>(isNaN(n)?0:n).toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:2});
const monthKey=d=>{const dt=d instanceof Date?d:new Date(d);return dt.toISOString().slice(0,7)};
const startOfMonth=(y,m)=>new Date(y,m-1,1), endOfMonth=(y,m)=>new Date(y,m,0,23,59,59,999);
const inMonth=(d,y,m)=>{const dt=new Date(d);return dt>=startOfMonth(y,m)&&dt<=endOfMonth(y,m)};
const id=()=>crypto.randomUUID?crypto.randomUUID():(Math.random().toString(36).slice(2)+Date.now());
const today=new Date(); const CURRENT_KEY=monthKey(today);

/* ========= Data (RESET to zeros) ========= */
const STORE="mysimplifi-lite-v1";
const seed={
  settings:{twoUsers:false,rollover:false,efSingle:6,efDual:3},
  accounts:[
    {id:id(),name:"Checking",type:"Checking",opening:0},
    {id:id(),name:"Credit Card",type:"Credit Card",opening:0},
  ],
  categories:[
    {id:id(),name:"Income",group:"Income",isIncome:true},
    {id:id(),name:"Rent",group:"Housing"},
    {id:id(),name:"Electricity",group:"Utilities"},
    {id:id(),name:"Water/Sewer",group:"Utilities"},
    {id:id(),name:"Gas/Heating",group:"Utilities"},
    {id:id(),name:"Internet",group:"Utilities"},
    {id:id(),name:"Groceries",group:"Food"},
    {id:id(),name:"Dining Out",group:"Food"},
    {id:id(),name:"Gasoline",group:"Transportation"},
    {id:id(),name:"Auto Insurance",group:"Transportation"},
    {id:id(),name:"Streaming Services",group:"Personal"},
    {id:id(),name:"Other Subscriptions",group:"Personal"},
    {id:id(),name:"Personal Care",group:"Personal"},
    {id:id(),name:"Loan Payments",group:"Debt"},
    {id:id(),name:"Emergency Fund",group:"Savings"},
    {id:id(),name:"Retirement",group:"Savings"},
    {id:id(),name:"Investments",group:"Savings"},
  ],
  budgets:{ [CURRENT_KEY]:{} },     // no pre-filled numbers
  transactions:[]                   // no seed income/outflows
};
let DB=load()||seed; save();

/* ========= Core helpers ========= */
const getCat=n=>DB.categories.find(c=>c.name===n);
const catsByGroup=()=>DB.categories.reduce((m,c)=>{if(c.isIncome)return m;(m[c.group]??=[]).push(c);return m;}, {});
const txnsFor=(y,m)=>DB.transactions.filter(t=>inMonth(t.date,y,m));
const sum=a=>a.reduce((x,y)=>x+(+y||0),0);
function accountBalance(name){
  const a=DB.accounts.find(a=>a.name===name); const base=a?.opening||0;
  const inflow=sum(DB.transactions.filter(t=>t.accountName===name).map(t=>+t.inflow||0));
  const outflow=sum(DB.transactions.filter(t=>t.accountName===name).map(t=>+t.outflow||0));
  return base+inflow-outflow;
}
function monthIncome(y,m){
  return sum(txnsFor(y,m).filter(t=>getCat(t.category)?.isIncome).map(t=>+t.inflow||0));
}
function activity(cat,y,m){
  const tx=txnsFor(y,m).filter(t=>t.category===cat);
  return sum(tx.map(t=>+t.outflow||0)) - sum(tx.map(t=>+t.inflow||0));
}
function budgeted(cat,y,m){
  const key=`${y}-${String(m).padStart(2,'0')}`, pg=DB.budgets[key]||{};
  return +pg[cat]||0;
}
function totalBudgeted(y,m){
  let tot=0; for(const g in catsByGroup()) catsByGroup()[g].forEach(c=>tot+=budgeted(c.name,y,m)); return tot;
}
function prevAvailable(cat,y,m){
  const d=new Date(y,m-2,1); if(d.getFullYear()<2000) return 0;
  const py=d.getFullYear(), pm=d.getMonth()+1;
  const b=budgeted(cat,py,pm), a=activity(cat,py,pm);
  return (DB.settings.rollover?prevAvailable(cat,py,pm):0)+b-a;
}
function available(cat,y,m){
  const b=budgeted(cat,y,m), a=activity(cat,y,m);
  return DB.settings.rollover?prevAvailable(cat,y,m)+b-a:b-a;
}
const TBB=(y,m)=> monthIncome(y,m)-totalBudgeted(y,m);

/* ========= Navigation ========= */
const view=$("#view"), nav=$("#nav"); const TABS=["Budget","Transactions","Accounts","Summary","Settings","Data"];
TABS.forEach(t=>{const b=document.createElement("button"); b.textContent=t; b.onclick=()=>render(t); nav.appendChild(b);});
function setActive(tab){ $$("nav button").forEach(b=>b.classList.toggle("active",b.textContent===tab)); }

/* ========= Budget ========= */
function renderBudget(){
  view.innerHTML=`
    <div class="row">
      <div class="card"><label>Month</label><input id="monthPick" type="month" value="${CURRENT_KEY}">
        <div class="muted" style="margin-top:6px">Budget per category. <span class="pill p-blue">TBB</span> updates instantly.</div>
      </div>
      <div class="card">
        <div><span class="pill p-green">Income</span> <b class="mono" id="incVal">—</b></div>
        <div style="margin-top:8px"><span class="pill p-blue">To Be Budgeted</span> <b class="mono" id="tbbVal">—</b></div>
      </div>
    </div>
    <div class="card">
      <table id="budTbl"><thead>
        <tr><th>Group</th><th>Category</th><th class="right">Budgeted</th><th class="right">Activity</th><th class="right">Available</th></tr>
      </thead><tbody></tbody>
      <tfoot><tr><td></td><td><b>TOTALS</b></td><td class="right mono" id="totB"></td><td class="right mono" id="totA"></td><td class="right mono" id="totV"></td></tr></tfoot></table>
    </div>
  `;
  const mEl=$("#monthPick");
  const draw=()=>{
    const [y,m]=mEl.value.split("-").map(Number);
    $("#incVal").textContent=money(monthIncome(y,m));
    $("#tbbVal").textContent=money(TBB(y,m));
    const body=$("#budTbl tbody"); body.innerHTML="";
    let TB=0, TA=0, TV=0;
    const groups=catsByGroup();
    Object.keys(groups).sort().forEach(g=>{
      const gr=document.createElement("tr"); gr.className="group";
      gr.innerHTML=`<td>${g}</td><td colspan="4"></td>`; body.appendChild(gr);
      groups[g].forEach(c=>{
        const b=budgeted(c.name,y,m), a=activity(c.name,y,m), v=available(c.name,y,m);
        TB+=b; TA+=a; TV+=v;
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td></td><td>${c.name}</td>
          <td class="right"><input class="mono" style="width:120px;text-align:right" type="number" step="0.01" value="${b}" data-cat="${c.name}"></td>
          <td class="right mono">${money(a)}</td>
          <td class="right mono ${v<0?'bad':'good'}">${money(v)}</td>`;
        body.appendChild(tr);
      });
    });
    $("#totB").textContent=money(TB); $("#totA").textContent=money(TA); $("#totV").textContent=money(TV);
    $$('input[data-cat]',body).forEach(inp=>{
      inp.onchange=e=>{
        const cat=e.target.dataset.cat, val=parseFloat(e.target.value||"0"), key=mEl.value;
        DB.budgets[key]=DB.budgets[key]||{}; DB.budgets[key][cat]=val; save(); draw();
      };
    });
  };
  mEl.onchange=draw; draw();
}

/* ========= Transactions ========= */
function renderTransactions(){
  view.innerHTML=`
    <div class="row">
      <div class="card"><label>Filter Month</label><input id="txMonth" type="month" value="${CURRENT_KEY}"></div>
      <div class="card">
        <label>New Transaction</label>
        <div class="row" style="gap:8px">
          <div style="flex:1 1 130px"><input id="txDate" type="date" value="${new Date().toISOString().slice(0,10)}"></div>
          <div style="flex:1 1 140px"><select id="txAcct"></select></div>
          <div style="flex:1 1 160px"><input id="txPayee" placeholder="Payee"></div>
          <div style="flex:1 1 170px"><select id="txCat"></select></div>
          <div style="flex:1 1 120px"><input id="txOut" type="number" step="0.01" placeholder="Outflow"></div>
          <div style="flex:1 1 120px"><input id="txIn" type="number" step="0.01" placeholder="Inflow"></div>
          <div><button class="btn" id="addTx">Add</button></div>
        </div>
        <div class="muted" style="margin-top:6px">Income = put amount in <b>Inflow</b> & pick category <b>Income</b>.</div>
      </div>
    </div>
    <div class="card">
      <table><thead><tr><th>Date</th><th>Account</th><th>Payee</th><th>Category</th><th class="right">Outflow</th><th class="right">Inflow</th><th></th></tr></thead>
      <tbody id="txBody"></tbody></table>
    </div>`;
  const acctSel=$("#txAcct"); DB.accounts.forEach(a=>acctSel.append(new Option(a.name,a.name)));
  const catSel=$("#txCat"); DB.categories.forEach(c=>catSel.append(new Option(`${c.group}: ${c.name}`,c.name)));
  const mEl=$("#txMonth");
  const draw=()=>{
    const [y,m]=mEl.value.split("-").map(Number);
    const body=$("#txBody"); body.innerHTML="";
    DB.transactions.filter(t=>inMonth(t.date,y,m)).sort((a,b)=>new Date(a.date)-new Date(b.date)).forEach(t=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td class="mono">${t.date}</td><td>${t.accountName}</td><td>${t.payee||""}</td><td>${t.category||""}</td>
        <td class="right mono">${t.outflow?money(t.outflow):""}</td><td class="right mono">${t.inflow?money(t.inflow):""}</td>
        <td class="right"><button class="btn secondary" data-del="${t.id}">Delete</button></td>`;
      body.appendChild(tr);
    });
    $$('button[data-del]',body).forEach(b=>b.onclick=()=>{ DB.transactions=DB.transactions.filter(t=>t.id!==b.dataset.del); save(); draw(); });
  };
  $("#addTx").onclick=()=>{
    const t={id:id(),date:$("#txDate").value,accountName:$("#txAcct").value,payee:$("#txPayee").value,
      category:$("#txCat").value,outflow:parseFloat($("#txOut").value||"0"),inflow:parseFloat($("#txIn").value||"0"),cleared:true};
    if(!(t.outflow||t.inflow)) return alert("Enter an outflow or inflow.");
    DB.transactions.push(t); save(); draw();
  };
  mEl.onchange=draw; draw();
}

/* ========= Accounts ========= */
function renderAccounts(){
  view.innerHTML=`
    <div class="row">
      <div class="card">
        <label>Add Account</label>
        <div class="row" style="gap:8px">
          <div style="flex:1 1 160px"><input id="accName" placeholder="Name (e.g., Checking)"></div>
          <div style="flex:1 1 160px"><select id="accType"><option>Checking</option><option>Savings</option><option>Credit Card</option><option>Cash</option></select></div>
          <div style="flex:1 1 140px"><input id="accOpen" type="number" step="0.01" placeholder="Opening $"></div>
          <div><button class="btn" id="addAcc">Add</button></div>
        </div>
      </div>
    </div>
    <div class="card">
      <table><thead><tr><th>Account</th><th>Type</th><th class="right">Opening</th><th class="right">Balance</th><th></th></tr></thead>
      <tbody id="accBody"></tbody></table>
    </div>`;
  const draw=()=>{
    const body=$("#accBody"); body.innerHTML="";
    DB.accounts.forEach(a=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${a.name}</td><td>${a.type}</td>
        <td class="right mono">${money(a.opening||0)}</td>
        <td class="right mono">${money(accountBalance(a.name))}</td>
        <td class="right"><button class="btn secondary" data-del="${a.id}">Delete</button></td>`;
      body.appendChild(tr);
    });
    $$('button[data-del]',body).forEach(b=>b.onclick=()=>{ DB.accounts=DB.accounts.filter(a=>a.id!==b.dataset.del); save(); draw(); });
  };
  $("#addAcc").onclick=()=>{
    const nm=$("#accName").value.trim(); if(!nm) return alert("Account name required.");
    DB.accounts.push({id:id(),name:nm,type:$("#accType").value,opening:parseFloat($("#accOpen").value||"0")});
    save(); draw();
  };
  draw();
}

/* ========= Summary ========= */
function renderSummary(){
  const key=CURRENT_KEY; const [y,m]=key.split("-").map(Number);
  const income=monthIncome(y,m);
  const outflows=sum(txnsFor(y,m).map(t=>+t.outflow||0));
  const cash=income-outflows;
  // expenses plan (excl. Savings)
  let planExp=0; for(const g in catsByGroup()){ if(g==="Savings") continue; catsByGroup()[g].forEach(c=> planExp+=budgeted(c.name,y,m)); }
  const efMonths = DB.settings.twoUsers ? DB.settings.efDual : DB.settings.efSingle;
  const housing=budgeted("Rent",y,m)+budgeted("Electricity",y,m)+budgeted("Water/Sewer",y,m)+budgeted("Gas/Heating",y,m)+budgeted("Internet",y,m);
  const debt=budgeted("Loan Payments",y,m);
  view.innerHTML=`
    <div class="row">
      <div class="card">
        <div><span class="pill p-green">Income (this month)</span> <b class="mono">${money(income)}</b></div>
        <div style="margin-top:8px"><span class="pill p-red">Outflows (this month)</span> <b class="mono">${money(outflows)}</b></div>
        <div style="margin-top:8px"><span class="pill p-blue">Cash Flow</span> <b class="mono ${cash<0?'bad':'good'}">${money(cash)}</b></div>
      </div>
      <div class="card">
        <div>Housing %: <b>${(income? (housing/income*100):0).toFixed(1)}%</b></div>
        <div>Debt %: <b>${(income? (debt/income*100):0).toFixed(1)}%</b></div>
        <div>Savings Rate (planned): <b>${(income? ((budgeted("Emergency Fund",y,m)+budgeted("Retirement",y,m)+budgeted("Investments",y,m))/income*100):0).toFixed(1)}%</b></div>
      </div>
      <div class="card">
        <div class="muted">Emergency Fund Target (${efMonths} mo of planned expenses)</div>
        <div style="margin-top:6px"><b>Target:</b> <span class="mono">${money(planExp*efMonths)}</span></div>
        <div style="margin-top:6px"><b>Current EF (available):</b> <span class="mono">${money(available("Emergency Fund",y,m))}</span></div>
        <div style="margin-top:6px"><b>Gap:</b> <span class="mono">${money(planExp*efMonths - available("Emergency Fund",y,m))}</span></div>
      </div>
    </div>`;
}

/* ========= Settings ========= */
function renderSettings(){
  view.innerHTML=`
    <div class="row">
      <div class="card">
        <label>Rollover Available</label>
        <select id="rollSel"><option value="false">Off (simple)</option><option value="true">On (YNAB-style)</option></select>
        <div class="muted" style="margin-top:6px">When ON, Available carries forward.</div>
      </div>
      <div class="card">
        <label>Household Users</label>
        <select id="usersSel"><option value="1">One</option><option value="2">Two</option></select>
        <div class="muted" style="margin-top:6px">EF target: 6 months (one) / 3 months (two).</div>
      </div>
    </div>
    <div class="row">
      <div class="card">
        <label>Add Category</label>
        <div class="row" style="gap:8px">
          <div style="flex:1 1 180px"><input id="newCatName" placeholder="Category name"></div>
          <div style="flex:1 1 160px"><input id="newCatGroup" placeholder="Group (e.g., Food)"></div>
          <div><button class="btn" id="addCat">Add</button></div>
        </div>
        <table style="margin-top:10px">
          <thead><tr><th>Group</th><th>Name</th><th>Income?</th><th></th></tr></thead>
          <tbody id="catBody"></tbody>
        </table>
      </div>
    </div>`;
  $("#rollSel").value=String(DB.settings.rollover);
  $("#usersSel").value=DB.settings.twoUsers?"2":"1";
  $("#rollSel").onchange=e=>{DB.settings.rollover=(e.target.value==="true"); save();};
  $("#usersSel").onchange=e=>{DB.settings.twoUsers=(e.target.value==="2"); save();};
  $("#addCat").onclick=()=>{
    const n=$("#newCatName").value.trim(); const g=$("#newCatGroup").value.trim()||"Other"; if(!n) return alert("Name required.");
    DB.categories.push({id:id(),name:n,group:g,isIncome:false}); save(); renderSettings();
  };
  const body=$("#catBody");
  DB.categories.sort((a,b)=>(a.group+a.name).localeCompare(b.group+b.name)).forEach(c=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${c.group}</td><td>${c.name}</td>
      <td><input type="checkbox" ${c.isIncome?'checked':''} data-inc="${c.id}"></td>
      <td class="right"><button class="btn secondary" data-del="${c.id}">Delete</button></td>`;
    body.appendChild(tr);
  });
  $$('input[data-inc]',body).forEach(chk=>chk.onchange=e=>{const C=DB.categories.find(x=>x.id===e.target.dataset.inc); C.isIncome=e.target.checked; save();});
  $$('button[data-del]',body).forEach(btn=>btn.onclick=()=>{DB.categories=DB.categories.filter(c=>c.id!==btn.dataset.del); save(); renderSettings();});
}

/* ========= Data (export/import/reset) ========= */
function renderData(){
  const json=JSON.stringify(DB,null,2);
  view.innerHTML=`
    <div class="row">
      <div class="card" style="flex:2 1 460px">
        <div class="muted">Export (backup JSON)</div>
        <textarea id="exp" style="width:100%;height:240px">${json}</textarea>
      </div>
      <div class="card" style="flex:1 1 320px">
        <div class="muted">Import / Reset</div>
        <textarea id="imp" placeholder="Paste JSON here" style="width:100%;height:140px"></textarea>
        <div class="row" style="gap:8px;margin-top:8px">
          <button class="btn" id="doImport">Import JSON</button>
          <button class="btn secondary" id="doReset">Reset (factory zeros)</button>
        </div>
      </div>
    </div>`;
  $("#doImport").onclick=()=>{
    try{ DB=JSON.parse($("#imp").value); save(); alert("Imported!"); render("Budget"); }
    catch(e){ alert("Invalid JSON"); }
  };
  $("#doReset").onclick=()=>{
    if(!confirm("Reset everything to zeros?"))return;
    DB=JSON.parse(JSON.stringify(seed)); save(); alert("Reset complete"); render("Budget");
  };
}

/* ========= Storage & boot ========= */
function save(){ localStorage.setItem(STORE, JSON.stringify(DB)); }
function load(){ try{return JSON.parse(localStorage.getItem(STORE));}catch(e){return null;} }

function render(tab="Budget"){
  $$("nav button").forEach(b=>b.classList.toggle("active",b.textContent===tab));
  if(tab==="Budget") return renderBudget();
  if(tab==="Transactions") return renderTransactions();
  if(tab==="Accounts") return renderAccounts();
  if(tab==="Summary") return renderSummary();
  if(tab==="Settings") return renderSettings();
  if(tab==="Data") return renderData();
}
TABS.forEach((t,i)=>nav.children[i].classList.toggle("active",t==="Budget"));
render("Budget");
</script>
</body>
</html>
